# AI 구독 관리 웹 애플리케이션 개발 지침

## 프로젝트 개요

- **목적**: AI 서비스 구독을 효율적으로 관리하는 웹 애플리케이션
- **핵심 기능**: 소셜 로그인, 구독 관리(CRUD), 구독 비용 분석 및 시각화
- **기술 스택**:
  - Next.js 15.1.8 (App Router 사용)
  - React 19.0.0
  - Supabase (인증 및 데이터베이스)
  - TailwindCSS + DaisyUI (UI 프레임워크)
  - React Hook Form + Zod (폼 검증)
  - Chart.js (데이터 시각화)
  - date-fns (날짜 처리)

## 프로젝트 아키텍처

### 디렉토리 구조
- **app/** - Next.js App Router 기반 페이지
  - **auth/** - 인증 관련 페이지 (로그인, 콜백)
  - **dashboard/** - 대시보드 페이지
  - **profile/** - 사용자 프로필 페이지
  - **tools/** - AI 툴 페이지
- **components/** - 재사용 가능한 UI 컴포넌트
  - **dashboard/** - 대시보드 관련 컴포넌트
  - **subscriptions/** - 구독 관련 컴포넌트
- **hooks/** - 커스텀 훅
- **lib/** - 유틸리티 및 설정
- **logs/** - 로그 파일 저장
- **public/** - 정적 파일

### 핵심 모듈
- **인증 모듈**: Supabase OAuth 활용 (Google, Kakao)
- **구독 관리 모듈**: 구독 CRUD 작업
- **대시보드 모듈**: 통계 및 시각화

## 코드 표준

### 명명 규칙
- **컴포넌트**: PascalCase 사용 (예: `SubscriptionFormModal.js`)
- **훅**: camelCase + 'use' 접두사 사용 (예: `useSubscriptions.js`)
- **유틸리티 함수**: camelCase 사용
- **페이지 파일**: Next.js App Router 규칙에 따라 `page.js` 사용

### 컴포넌트 패턴
- **'use client'** 지시문: 클라이언트 컴포넌트에 필수 추가
- **React.memo()** 사용: 성능 최적화를 위해 컴포넌트 메모이제이션
- **Fragment 사용**: 불필요한 DOM 요소 방지
- **컴포넌트 크기**: 파일당 300줄 이하 유지
- **displayName 설정**: memo 컴포넌트에 반드시 설정 (예: `Component.displayName = 'Component'`)

### 상태 관리
- **useState**: 단순한 컴포넌트 내부 상태 관리
- **useEffect**: 사이드 이펙트 처리 (데이터 로딩, 구독 등)
- **useCallback**: 함수 메모이제이션
- **useMemo**: 값 메모이제이션
- **커스텀 훅**: 로직 재사용 및 관심사 분리

### 에러 처리
- **try-catch 블록**: 모든 비동기 작업에 사용
- **사용자 친화적 에러 메시지**: 기술적 에러를 이해하기 쉬운 메시지로 변환
- **로깅**: 개발용 로그는 `console.error()` 사용, 프로덕션 로그는 `logs/` 디렉토리에 저장

## 기능 구현 표준

### 인증 구현
- **Supabase OAuth**: `lib/supabase.js`의 함수 사용
- **세션 관리**: `useSessionManager` 훅 사용
- **인증 상태**: 모든 보호된 페이지에서 인증 상태 확인
- **콜백 처리**: `/auth/callback` 페이지에서 OAuth 리다이렉션 처리

### 구독 관리 구현
- **데이터 모델**: Supabase `subscriptions` 테이블 사용
- **구독 CRUD**: `useSubscriptions` 훅 사용
- **폼 검증**: React Hook Form + Zod 스키마 사용
- **모달 구현**: 구독 추가/편집/상세 정보를 모달로 표시

### 대시보드 구현
- **통계 카드**: `StatCard` 컴포넌트 사용
- **탭 네비게이션**: `DashboardTabs` 컴포넌트 사용
- **비어있는 상태**: `EmptyState` 컴포넌트 사용
- **로딩 상태**: `SubscriptionsSkeleton` 컴포넌트 사용
- **알림**: `StatusAlert` 컴포넌트 사용

### 차트 및 시각화 구현
- **Chart.js 활용**: React-Chartjs-2 라이브러리 사용
- **차트 컴포넌트**: `components/dashboard/` 디렉토리에 추가
- **데이터 포맷팅**: 훅에서 차트 데이터 계산 및 포맷팅

## 서드파티 라이브러리 사용 표준

### React Hook Form + Zod
- **스키마 정의**: 각 폼의 유효성 검사 규칙을 Zod 스키마로 정의
- **훅 사용**: `useForm` 훅과 `zodResolver` 사용
- **에러 처리**: 각 필드마다 에러 메시지 표시

### Chart.js
- **차트 유형**: 구독 데이터에 적합한 차트 유형 선택 (파이, 바 등)
- **반응형 설계**: 모바일에서도 작동하는 반응형 차트 구현
- **테마 통합**: DaisyUI 테마 색상과 일치하도록 설정

### date-fns
- **날짜 포맷**: `format` 함수 사용
- **날짜 계산**: `differenceInDays` 등의 함수 사용
- **지역화**: 한국어 로케일 사용 (`ko`)

## 워크플로우 표준

### 페이지 로딩 흐름
1. 페이지 초기 로딩 시 인증 상태 확인
2. 인증되지 않은 경우 로그인 페이지로 리다이렉트
3. 인증된 경우 데이터 로드 (구독 정보 등)
4. 로딩 중 스켈레톤 UI 표시
5. 데이터 로드 완료 후 UI 렌더링

### 인증 상태 관리 흐름
1. `useSessionManager` 훅으로 인증 상태 감지
2. 인증 이벤트(로그인, 로그아웃, 토큰 갱신 등) 감지 및 처리
3. 세션 만료 시 자동 리다이렉트 및 사용자에게 알림

### 데이터 관리 흐름
1. 페이지 컴포넌트에서 해당 훅 호출
2. 훅 내부에서 Supabase API 호출
3. 데이터 정규화 및 로컬 상태 업데이트
4. UI에 데이터 표시
5. 사용자 액션에 따라 데이터 업데이트

## 주요 파일 상호작용 표준

### hooks와 컴포넌트 간 상호작용
- **훅 사용**: 컴포넌트에서 필요한 훅 가져와 사용
- **데이터 흐름**: 훅에서 반환된 데이터 및 함수를 컴포넌트 props로 전달
- **상태 공유**: 훅을 통해 여러 컴포넌트 간 상태 공유

### 페이지와 컴포넌트 간 상호작용
- **페이지 구성**: 여러 작은 컴포넌트를 조합하여 페이지 구성
- **이벤트 처리**: 페이지 레벨에서 정의된 핸들러를 컴포넌트에 전달
- **상태 관리**: 페이지 레벨에서 상태 관리 후 컴포넌트에 전달

### Supabase와 hooks 간 상호작용
- **클라이언트 초기화**: `lib/supabase.js`에서 Supabase 클라이언트 초기화
- **API 호출**: 훅 내부에서 Supabase API 호출
- **인증 이벤트**: Supabase 인증 이벤트 구독 및 처리

## AI 의사결정 표준

### 새 기능 추가 시 고려사항
1. 기존 디렉토리 구조와 명명 규칙 따르기
2. 기존 컴포넌트 및 훅 재사용 가능성 검토
3. 새 기능이 기존 기능에 미치는 영향 분석
4. 적절한 테스트 및 에러 처리 구현

### 버그 수정 시 고려사항
1. 버그의 근본 원인 파악
2. 최소한의 변경으로 버그 수정
3. 동일한 버그가 다른 곳에서도 발생하는지 확인
4. 버그 수정이 다른 기능에 영향을 미치지 않는지 확인

### 성능 최적화 시 고려사항
1. 불필요한 렌더링 최소화 (memo, useCallback, useMemo 사용)
2. 데이터 로딩 최적화 (캐싱, 페이지네이션 등)
3. 코드 스플리팅 활용
4. 이미지 및 정적 파일 최적화

## 금지된 작업

### 환경 변수 관련
- **금지**: .env.local 파일을 Git에 커밋하는 행위
- **금지**: 클라이언트 코드에서 서버 전용 환경 변수 접근
- **필수**: NEXT_PUBLIC_ 접두사가 없는 환경 변수는 서버 컴포넌트에서만 사용

### 인증 로직 관련
- **금지**: Supabase 인증 흐름 임의 변경
- **금지**: 사용자 정보를 안전하지 않은 방식으로 저장
- **필수**: 모든 보호된 경로에 인증 상태 확인 로직 추가

### 데이터 구조 관련
- **금지**: Supabase 테이블 스키마 임의 변경
- **금지**: 구독 데이터 구조 임의 변경
- **필수**: 스키마 변경 시 마이그레이션 계획 수립

### 성능 관련
- **금지**: 무거운 연산을 렌더링 중에 수행
- **금지**: 대용량 데이터를 클라이언트 상태로 관리
- **필수**: 리스트 렌더링 시 고유 키 사용

## 개선이 필요한 기능

### 차트/시각화 구현
- **요구사항**: Chart.js를 사용하여 구독 비용 분석 차트 구현
- **위치**: `components/dashboard/charts/` 디렉토리에 컴포넌트 추가
- **데이터**: `useSubscriptions` 훅의 데이터 활용

### 리포트 탭 기능
- **요구사항**: 구독 비용 분석 및 최적화 제안 리포트 구현
- **위치**: `app/dashboard/reports/page.js` 파일 및 관련 컴포넌트 구현
- **데이터**: 구독 데이터 분석 결과 표시

### 설정 탭 기능
- **요구사항**: 사용자 프로필 및 알림 설정 기능 구현
- **위치**: `app/dashboard/settings/page.js` 파일 및 관련 컴포넌트 구현
- **기능**: 프로필 수정, 알림 설정, 테마 설정 등

### AI 툴 탭 기능
- **요구사항**: AI 서비스 추천 및 비교 기능 구현
- **위치**: `app/dashboard/tools/page.js` 파일 및 관련 컴포넌트 구현
- **기능**: AI 툴 목록, 비교, 리뷰 등 